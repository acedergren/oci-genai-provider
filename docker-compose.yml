# Docker Compose for OpenCode OCI GenAI Demos
# Production deployment with Cloudflare Tunnel

services:
  # Cloudflare Tunnel - handles TLS and routing
  cloudflared:
    image: cloudflare/cloudflared:latest
    command: tunnel --no-autoupdate run
    environment:
      - TUNNEL_TOKEN=${CLOUDFLARE_TUNNEL_TOKEN}
    networks:
      - internal
    restart: unless-stopped
    depends_on:
      - chatbot-sveltekit
      - chatbot-nextjs

  # SvelteKit Chatbot Demo
  chatbot-sveltekit:
    build:
      context: .
      dockerfile: examples/chatbot-demo/Dockerfile
    environment:
      - OCI_COMPARTMENT_ID=${OCI_COMPARTMENT_ID}
      - OCI_REGION=${OCI_REGION:-eu-frankfurt-1}
      - OCI_CONFIG_PROFILE=${OCI_CONFIG_PROFILE:-FRANKFURT}
    volumes:
      - ${OCI_CONFIG_PATH:-/opt/secrets/oci}:/home/sveltekit/.oci:ro
    networks:
      - internal
    restart: unless-stopped

  # Next.js Chatbot Demo
  chatbot-nextjs:
    build:
      context: .
      dockerfile: examples/nextjs-chatbot/Dockerfile
    environment:
      - OCI_COMPARTMENT_ID=${OCI_COMPARTMENT_ID}
      - OCI_REGION=${OCI_REGION:-eu-frankfurt-1}
      - OCI_CONFIG_PROFILE=${OCI_CONFIG_PROFILE:-FRANKFURT}
    volumes:
      - ${OCI_CONFIG_PATH:-/opt/secrets/oci}:/home/nextjs/.oci:ro
    networks:
      - internal
    restart: unless-stopped

networks:
  internal:
    name: oci-genai-internal
