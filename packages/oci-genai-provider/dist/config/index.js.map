{"version":3,"sources":["../../src/config/oci-config.ts","../../src/config/validation.ts","../../src/config/discovery.ts","../../src/config/fallback.ts"],"names":["path","os","fs","common","identity","common2","identity2","path2","os2","fs2"],"mappings":"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","file":"index.js","sourcesContent":["/**\n * OCI Config Parser\n *\n * Parses ~/.oci/config to discover available profiles with their\n * regions, credentials, and tenancy information. This module is\n * the foundation for auto-discovery in the setup CLI.\n *\n * @example\n * ```typescript\n * import { parseOCIConfig, getProfile, hasOCIConfig } from '@acedergren/oci-genai-provider/config';\n *\n * // Check if OCI config exists\n * if (hasOCIConfig()) {\n *   // Parse all profiles\n *   const result = parseOCIConfig();\n *   console.log(`Found ${result.profiles.length} profile(s)`);\n *\n *   // Get a specific profile\n *   const profile = getProfile('FRANKFURT');\n *   console.log(`Region: ${profile?.region}`);\n * }\n * ```\n */\n\nimport * as fs from 'node:fs';\nimport * as os from 'node:os';\nimport * as path from 'node:path';\nimport type { OCIProfile, OCIConfigResult } from './types';\n\n/**\n * Default OCI config file location\n */\nconst DEFAULT_CONFIG_PATH = '~/.oci/config';\n\n/**\n * Expand ~ to home directory in paths\n *\n * @param filePath - Path that may start with ~\n * @returns Expanded absolute path\n *\n * @example\n * ```typescript\n * expandPath('~/.oci/key.pem') // => '/home/user/.oci/key.pem'\n * expandPath('/absolute/path') // => '/absolute/path'\n * ```\n */\nexport function expandPath(filePath: string): string {\n  if (!filePath) return filePath;\n  if (filePath.startsWith('~')) {\n    return path.join(os.homedir(), filePath.slice(1));\n  }\n  return filePath;\n}\n\n/**\n * Get the OCI config file path\n *\n * Returns the path specified in OCI_CONFIG_FILE environment variable,\n * or the default ~/.oci/config path.\n *\n * @returns Resolved config file path\n */\nexport function getConfigPath(): string {\n  return expandPath(process.env.OCI_CONFIG_FILE || DEFAULT_CONFIG_PATH);\n}\n\n/**\n * Check if OCI config file exists and has content\n *\n * Use this before attempting to parse to give users helpful\n * guidance when config is missing.\n *\n * @returns true if config exists and is non-empty\n *\n * @example\n * ```typescript\n * if (!hasOCIConfig()) {\n *   console.log('Please run: oci setup config');\n * }\n * ```\n */\nexport function hasOCIConfig(): boolean {\n  const configPath = getConfigPath();\n  try {\n    return fs.existsSync(configPath) && fs.statSync(configPath).size > 0;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Parse INI-style OCI config file\n *\n * Handles the OCI config format with [SECTION] headers and key=value pairs.\n * Comments (#, ;) and empty lines are ignored.\n *\n * @internal\n */\nfunction parseINI(content: string): Record<string, Record<string, string>> {\n  const result: Record<string, Record<string, string>> = {};\n  let currentSection = '';\n\n  for (const line of content.split('\\n')) {\n    const trimmed = line.trim();\n\n    // Skip empty lines and comments\n    if (!trimmed || trimmed.startsWith('#') || trimmed.startsWith(';')) {\n      continue;\n    }\n\n    // Section header [SECTION_NAME]\n    const sectionMatch = trimmed.match(/^\\[([^\\]]+)\\]$/);\n    if (sectionMatch) {\n      currentSection = sectionMatch[1];\n      result[currentSection] = {};\n      continue;\n    }\n\n    // Key=value pair\n    const kvMatch = trimmed.match(/^([^=]+)=(.*)$/);\n    if (kvMatch && currentSection) {\n      const key = kvMatch[1].trim();\n      const value = kvMatch[2].trim();\n      result[currentSection][key] = value;\n    }\n  }\n\n  return result;\n}\n\n/**\n * Parse ~/.oci/config and return all profiles\n *\n * This is the main entry point for config discovery. It reads the\n * OCI config file and extracts all profiles with their settings.\n *\n * @param configPath - Optional custom config path (defaults to ~/.oci/config)\n * @returns Parsed config result with profiles\n *\n * @example\n * ```typescript\n * const result = parseOCIConfig();\n *\n * if (result.found) {\n *   for (const profile of result.profiles) {\n *     console.log(`${profile.name}: ${profile.region}`);\n *   }\n * } else {\n *   console.error(result.error);\n * }\n * ```\n */\nexport function parseOCIConfig(configPath?: string): OCIConfigResult {\n  const resolvedPath = configPath ? expandPath(configPath) : getConfigPath();\n\n  if (!fs.existsSync(resolvedPath)) {\n    return {\n      found: false,\n      path: resolvedPath,\n      profiles: [],\n      error: `Config file not found at ${resolvedPath}`,\n    };\n  }\n\n  try {\n    const content = fs.readFileSync(resolvedPath, 'utf-8');\n    const parsed = parseINI(content);\n\n    const profiles: OCIProfile[] = Object.entries(parsed).map(([name, values]) => {\n      const keyFile = expandPath(values.key_file || '');\n      const keyFileValid = keyFile ? fs.existsSync(keyFile) : false;\n\n      return {\n        name,\n        region: values.region || '',\n        user: values.user || '',\n        tenancy: values.tenancy || '',\n        fingerprint: values.fingerprint || '',\n        keyFile,\n        keyFileValid,\n      };\n    });\n\n    return {\n      found: true,\n      path: resolvedPath,\n      profiles,\n    };\n  } catch (error) {\n    return {\n      found: false,\n      path: resolvedPath,\n      profiles: [],\n      error: `Failed to parse config: ${error instanceof Error ? error.message : 'Unknown error'}`,\n    };\n  }\n}\n\n/**\n * Get a specific profile by name\n *\n * Convenience function for getting a single profile. Returns undefined\n * if the profile doesn't exist or config file is not found.\n *\n * @param profileName - Profile name (default: 'DEFAULT')\n * @returns Profile or undefined if not found\n *\n * @example\n * ```typescript\n * const profile = getProfile('FRANKFURT');\n * if (profile) {\n *   console.log(`Using region: ${profile.region}`);\n * }\n * ```\n */\nexport function getProfile(profileName = 'DEFAULT'): OCIProfile | undefined {\n  const result = parseOCIConfig();\n  if (!result.found) return undefined;\n  return result.profiles.find((p) => p.name === profileName);\n}\n","/**\n * OCI Credential Validation\n *\n * Validates OCI credentials by making a test API call to verify\n * authentication works correctly.\n *\n * @example\n * ```typescript\n * import { validateCredentials } from '@acedergren/oci-genai-provider/config';\n *\n * const result = await validateCredentials('FRANKFURT');\n * if (result.valid) {\n *   console.log(`Authenticated as: ${result.userName}`);\n * } else {\n *   console.error(`Authentication failed: ${result.error}`);\n * }\n * ```\n */\n\nimport * as common from 'oci-common';\nimport * as identity from 'oci-identity';\nimport type { ValidationResult } from './types';\n\n/**\n * Validate OCI credentials by making a test API call\n *\n * This function attempts to authenticate using the specified profile\n * and makes a GetUser API call to verify the credentials work.\n *\n * @param profileName - Profile name from ~/.oci/config (default: 'DEFAULT')\n * @param timeoutMs - Timeout in milliseconds (default: 10000)\n * @returns Validation result with user info if successful\n *\n * @example\n * ```typescript\n * // Validate default profile\n * const result = await validateCredentials();\n *\n * // Validate specific profile\n * const frankfurtResult = await validateCredentials('FRANKFURT');\n * ```\n */\nexport async function validateCredentials(\n  profileName = 'DEFAULT',\n  timeoutMs = 10000\n): Promise<ValidationResult> {\n  try {\n    const authProvider = new common.ConfigFileAuthenticationDetailsProvider(\n      undefined, // Use default config path\n      profileName\n    );\n\n    const identityClient = new identity.IdentityClient({\n      authenticationDetailsProvider: authProvider,\n    });\n\n    // Set timeout using AbortController\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\n\n    try {\n      // Get the user ID from the auth provider\n      const userId = await authProvider.getUser();\n\n      // Fetch user details to validate credentials work\n      const response = await identityClient.getUser({ userId });\n\n      clearTimeout(timeoutId);\n\n      return {\n        valid: true,\n        userName: response.user.name,\n        userEmail: response.user.email,\n      };\n    } catch (error) {\n      clearTimeout(timeoutId);\n      throw error;\n    }\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Unknown error';\n\n    // Provide helpful error messages based on error type\n    if (message.includes('NotAuthenticated')) {\n      return {\n        valid: false,\n        error: 'Authentication failed. Check your API key and fingerprint.',\n      };\n    }\n\n    if (message.includes('timeout') || message.includes('abort')) {\n      return {\n        valid: false,\n        error: 'Connection timeout. Check network and OCI endpoint accessibility.',\n      };\n    }\n\n    if (message.includes('key_file') || message.includes('key file')) {\n      return {\n        valid: false,\n        error: 'Private key file not found or not readable.',\n      };\n    }\n\n    return {\n      valid: false,\n      error: `Validation failed: ${message}`,\n    };\n  }\n}\n","/**\n * OCI Compartment Discovery\n *\n * Discovers available compartments from the OCI API for user selection\n * during setup. Shows compartment names (not just OCIDs) for a better UX.\n *\n * @example\n * ```typescript\n * import { discoverCompartments } from '@acedergren/oci-genai-provider/config';\n *\n * const compartments = await discoverCompartments('FRANKFURT');\n * for (const c of compartments) {\n *   console.log(`${c.name}: ${c.id}`);\n * }\n * ```\n */\n\nimport * as common from 'oci-common';\nimport * as identity from 'oci-identity';\nimport type { OCICompartment } from './types';\n\n/**\n * Discover compartments from OCI API\n *\n * Lists all compartments accessible to the authenticated user,\n * including the root tenancy compartment.\n *\n * @param profileName - Profile name from ~/.oci/config (default: 'DEFAULT')\n * @param includeRoot - Include root compartment/tenancy (default: true)\n * @returns Array of compartments with their names and OCIDs\n *\n * @example\n * ```typescript\n * // Discover all compartments including root\n * const compartments = await discoverCompartments('FRANKFURT');\n *\n * // Discover compartments without root\n * const subCompartments = await discoverCompartments('FRANKFURT', false);\n * ```\n */\nexport async function discoverCompartments(\n  profileName = 'DEFAULT',\n  includeRoot = true\n): Promise<OCICompartment[]> {\n  const authProvider = new common.ConfigFileAuthenticationDetailsProvider(undefined, profileName);\n\n  const identityClient = new identity.IdentityClient({\n    authenticationDetailsProvider: authProvider,\n  });\n\n  // Get tenancy ID (root compartment)\n  const tenancyId = await authProvider.getTenantId();\n\n  const compartments: OCICompartment[] = [];\n\n  // Optionally include root compartment (tenancy)\n  if (includeRoot) {\n    const tenancy = await identityClient.getTenancy({ tenancyId });\n    compartments.push({\n      id: tenancyId,\n      name: tenancy.tenancy.name || 'root',\n      description: 'Root compartment (tenancy)',\n      lifecycleState: 'ACTIVE',\n    });\n  }\n\n  // List all compartments under the tenancy\n  // Using 'ACTIVE' string instead of enum to avoid mock issues\n  const response = await identityClient.listCompartments({\n    compartmentId: tenancyId,\n    compartmentIdInSubtree: true,\n    lifecycleState: 'ACTIVE' as identity.models.Compartment.LifecycleState,\n  });\n\n  for (const compartment of response.items) {\n    compartments.push({\n      id: compartment.id,\n      name: compartment.name,\n      description: compartment.description,\n      lifecycleState: compartment.lifecycleState,\n    });\n  }\n\n  return compartments;\n}\n","/**\n * Fallback Utilities for OCI Configuration\n *\n * Provides utilities for users who don't have OCI CLI installed,\n * including manual configuration options and environment variable support.\n *\n * @example\n * ```typescript\n * import {\n *   OCI_REGIONS,\n *   profileFromEnvironment,\n *   getSetupInstructions,\n * } from '@acedergren/oci-genai-provider/config';\n *\n * // Check for environment-based profile\n * const envProfile = profileFromEnvironment();\n * if (envProfile) {\n *   console.log(`Using profile from environment: ${envProfile.region}`);\n * } else {\n *   console.log(getSetupInstructions());\n * }\n * ```\n */\n\nimport * as fs from 'node:fs';\nimport * as os from 'node:os';\nimport * as path from 'node:path';\nimport type { OCIProfile } from './types';\n\n/**\n * Available OCI regions with GenAI service support\n *\n * These regions have OCI Generative AI service available.\n * Not all models are available in all regions - check OCI documentation.\n */\nexport const OCI_REGIONS = [\n  { id: 'eu-frankfurt-1', name: 'Germany Central (Frankfurt)' },\n  { id: 'eu-stockholm-1', name: 'Sweden Central (Stockholm)' },\n  { id: 'us-ashburn-1', name: 'US East (Ashburn)' },\n  { id: 'us-chicago-1', name: 'US Midwest (Chicago)' },\n  { id: 'us-phoenix-1', name: 'US West (Phoenix)' },\n  { id: 'uk-london-1', name: 'UK South (London)' },\n  { id: 'ap-tokyo-1', name: 'Japan East (Tokyo)' },\n  { id: 'ap-osaka-1', name: 'Japan Central (Osaka)' },\n  { id: 'ap-mumbai-1', name: 'India West (Mumbai)' },\n  { id: 'ap-sydney-1', name: 'Australia East (Sydney)' },\n  { id: 'ap-melbourne-1', name: 'Australia Southeast (Melbourne)' },\n  { id: 'ca-toronto-1', name: 'Canada Southeast (Toronto)' },\n  { id: 'ca-montreal-1', name: 'Canada Northeast (Montreal)' },\n  { id: 'sa-saopaulo-1', name: 'Brazil East (SÃ£o Paulo)' },\n  { id: 'me-dubai-1', name: 'UAE East (Dubai)' },\n  { id: 'me-jeddah-1', name: 'Saudi Arabia West (Jeddah)' },\n] as const;\n\nexport type OCIRegionId = (typeof OCI_REGIONS)[number]['id'];\n\n/**\n * Information needed for manual OCI setup\n *\n * These values are required to create an ~/.oci/config file manually.\n */\nexport interface ManualSetupInfo {\n  /** User OCID (ocid1.user.oc1...) */\n  user: string;\n  /** API key fingerprint (aa:bb:cc:...) */\n  fingerprint: string;\n  /** Path to private key file */\n  keyFilePath: string;\n  /** Tenancy OCID (ocid1.tenancy.oc1...) */\n  tenancy: string;\n  /** OCI region */\n  region: OCIRegionId | string;\n  /** Profile name (e.g., \"DEFAULT\", \"FRANKFURT\") */\n  profileName: string;\n}\n\n/**\n * Create ~/.oci directory if it doesn't exist\n *\n * @returns Path to the OCI directory\n */\nexport function ensureOCIDirectory(): string {\n  const ociDir = path.join(os.homedir(), '.oci');\n  if (!fs.existsSync(ociDir)) {\n    fs.mkdirSync(ociDir, { recursive: true, mode: 0o700 });\n  }\n  return ociDir;\n}\n\n/**\n * Generate OCI config file content from manual setup info\n *\n * @param info - Manual setup information\n * @returns INI-formatted config content\n */\nexport function generateConfigContent(info: ManualSetupInfo): string {\n  return `[${info.profileName}]\nuser=${info.user}\nfingerprint=${info.fingerprint}\nkey_file=${info.keyFilePath}\ntenancy=${info.tenancy}\nregion=${info.region}\n`;\n}\n\n/**\n * Write OCI config file\n *\n * @param info - Manual setup information\n * @param append - Append to existing config (default: false)\n *\n * @example\n * ```typescript\n * writeOCIConfig({\n *   user: 'ocid1.user.oc1..aaaa...',\n *   fingerprint: 'aa:bb:cc:...',\n *   keyFilePath: '~/.oci/oci_api_key.pem',\n *   tenancy: 'ocid1.tenancy.oc1..aaaa...',\n *   region: 'eu-frankfurt-1',\n *   profileName: 'FRANKFURT',\n * });\n * ```\n */\nexport function writeOCIConfig(info: ManualSetupInfo, append = false): void {\n  const ociDir = ensureOCIDirectory();\n  const configPath = path.join(ociDir, 'config');\n\n  const content = generateConfigContent(info);\n\n  if (append && fs.existsSync(configPath)) {\n    fs.appendFileSync(configPath, '\\n' + content);\n  } else {\n    fs.writeFileSync(configPath, content, { mode: 0o600 });\n  }\n}\n\n/**\n * Create a profile from environment variables\n *\n * Required environment variables:\n * - OCI_USER_OCID: User OCID\n * - OCI_FINGERPRINT: API key fingerprint\n * - OCI_KEY_FILE: Path to private key file\n * - OCI_TENANCY_OCID: Tenancy OCID\n * - OCI_REGION: OCI region\n *\n * @returns Profile or undefined if required env vars are not set\n *\n * @example\n * ```typescript\n * const profile = profileFromEnvironment();\n * if (profile) {\n *   console.log(`Using ${profile.name} profile from environment`);\n * }\n * ```\n */\nexport function profileFromEnvironment(): OCIProfile | undefined {\n  const user = process.env.OCI_USER_OCID;\n  const fingerprint = process.env.OCI_FINGERPRINT;\n  const keyFile = process.env.OCI_KEY_FILE;\n  const tenancy = process.env.OCI_TENANCY_OCID;\n  const region = process.env.OCI_REGION;\n\n  if (!user || !fingerprint || !keyFile || !tenancy || !region) {\n    return undefined;\n  }\n\n  const expandedKeyFile = keyFile.startsWith('~')\n    ? path.join(os.homedir(), keyFile.slice(1))\n    : keyFile;\n\n  return {\n    name: 'ENV',\n    user,\n    fingerprint,\n    keyFile: expandedKeyFile,\n    keyFileValid: fs.existsSync(expandedKeyFile),\n    tenancy,\n    region,\n  };\n}\n\n/**\n * Get setup instructions for users without OCI CLI\n *\n * Returns human-readable instructions for setting up OCI credentials.\n *\n * @returns Setup instructions string\n */\nexport function getSetupInstructions(): string {\n  return `\nTo use OCI GenAI, you need OCI credentials configured.\n\nOption 1: Install OCI CLI (Recommended)\n  1. Install: https://docs.oracle.com/iaas/Content/API/SDKDocs/cliinstall.htm\n  2. Run: oci setup config\n  3. Re-run this setup tool\n\nOption 2: Manual Configuration\n  1. Create an API key in OCI Console (Identity > Users > Your User > API Keys)\n  2. Download the private key\n  3. Note your User OCID, Tenancy OCID, and Fingerprint\n  4. Create ~/.oci/config with these values\n\nOption 3: Environment Variables\n  Set these in your shell:\n    export OCI_USER_OCID=ocid1.user.oc1..aaaa...\n    export OCI_FINGERPRINT=aa:bb:cc:...\n    export OCI_KEY_FILE=~/.oci/oci_api_key.pem\n    export OCI_TENANCY_OCID=ocid1.tenancy.oc1..aaaa...\n    export OCI_REGION=eu-frankfurt-1\n    export OCI_COMPARTMENT_ID=ocid1.compartment.oc1..aaaa...\n`;\n}\n\n/**\n * Known OCID types for validation\n */\nconst OCID_TYPES = [\n  'user',\n  'compartment',\n  'tenancy',\n  'instance',\n  'group',\n  'policy',\n  'vcn',\n  'subnet',\n] as const;\n\ntype OCIDType = (typeof OCID_TYPES)[number];\n\n/**\n * Validate an OCID format\n *\n * @param ocid - OCID to validate\n * @param type - Expected type (e.g., 'user', 'compartment', 'tenancy')\n * @returns true if OCID format is valid\n */\nexport function isValidOCID(ocid: string, type?: OCIDType): boolean {\n  // Basic OCID format: ocid1.<type>.<realm>.<region>.<unique-id>\n  const basicPattern = /^ocid1\\.[a-z]+\\.[a-z0-9]+\\..+$/;\n  if (!basicPattern.test(ocid)) {\n    return false;\n  }\n\n  if (type) {\n    // Extract the type from the OCID (second segment)\n    const parts = ocid.split('.');\n    if (parts.length < 3) {\n      return false;\n    }\n    const ocidType = parts[1];\n    return ocidType === type;\n  }\n\n  return true;\n}\n\n/**\n * Get region name from region ID\n *\n * @param regionId - Region identifier (e.g., 'eu-frankfurt-1')\n * @returns Region display name or the ID if not found\n */\nexport function getRegionName(regionId: string): string {\n  const region = OCI_REGIONS.find((r) => r.id === regionId);\n  return region?.name || regionId;\n}\n"]}