{"version":3,"sources":["../src/index.ts"],"names":["createOCI"],"mappings":";;;;;;;;AAoFe,SAAR,0BAA2C,OAAA,EAAyC;AAEzF,EAAA,MAAM,MAAA,GAAoB;AAAA;AAAA,IAExB,aAAA,EAAe,OAAA,CAAQ,aAAA,IAAiB,OAAA,CAAQ,GAAA,CAAI,kBAAA;AAAA;AAAA,IAGpD,OAAA,EAAS,OAAA,CAAQ,aAAA,IAAiB,OAAA,CAAQ,IAAI,kBAAA,IAAsB,SAAA;AAAA;AAAA,IAGpE,MAAA,EAAQ,OAAA,CAAQ,MAAA,IAAU,OAAA,CAAQ,GAAA,CAAI,UAAA;AAAA;AAAA,IAGtC,UAAA,EAAY,QAAQ,GAAA,CAAI,eAAA;AAAA;AAAA,IAGxB,IAAA,EAAM;AAAA,GACR;AAGA,EAAA,IAAI,CAAC,OAAO,aAAA,EAAe;AACzB,IAAA,MAAM,IAAI,KAAA;AAAA,MACR,CAAA;;AAAA;AAAA;;AAAA;AAAA,oDAAA;AAAA,KAOF;AAAA,EACF;AAEA,EAAA,MAAM,QAAA,GAAWA,2BAAU,MAAM,CAAA;AAEjC,EAAA,OAAA,CAAQ,IAAI,0BAAA,EAA4B,OAAO,UAAU,CAAC,CAAC,SAAS,MAAM,CAAA;AAC1E,EAAA,IAAI,SAAS,MAAA,EAAQ;AACnB,IAAA,OAAA,CAAQ,GAAA,CAAI,iCAAiC,MAAA,CAAO,IAAA,CAAK,SAAS,MAAM,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC,CAAA;AAAA,EACtF;AAGA,EAAA,MAAM,kBAAA,GAAqB;AAAA,IACzB,GAAG,QAAA;AAAA,IACH,QAAQ,QAAA,CAAS;AAAA,GACnB;AAEA,EAAA,OAAO,kBAAA;AACT","file":"index.js","sourcesContent":["/**\n * OpenCode Integration for OCI Generative AI Provider\n *\n * This package provides an OpenCode-compatible factory function\n * that creates an OCI GenAI provider instance. OpenCode calls this\n * factory with configuration from opencode.json.\n *\n * Usage in opencode.json:\n * ```json\n * {\n *   \"provider\": {\n *     \"oci-genai\": {\n *       \"npm\": \"@acedergren/opencode-oci-genai\",\n *       \"options\": {\n *         \"compartmentId\": \"{env:OCI_COMPARTMENT_ID}\",\n *         \"configProfile\": \"FRANKFURT\"\n *       }\n *     }\n *   }\n * }\n * ```\n *\n * @packageDocumentation\n */\n\nimport { createOCI, type OCIConfig } from '@acedergren/oci-genai-provider';\nimport type { ProviderV3 } from '@ai-sdk/provider';\n\n/**\n * OpenCode configuration options\n *\n * These are passed from opencode.json \"options\" field.\n * OpenCode substitutes {env:VAR_NAME} with environment variables.\n */\nexport interface OpenCodeOCIOptions {\n  /**\n   * Compartment OCID for OCI GenAI API calls\n   *\n   * Required. Can use {env:OCI_COMPARTMENT_ID} in opencode.json.\n   *\n   * @example \"ocid1.compartment.oc1..aaaaaaa...\"\n   */\n  compartmentId: string;\n\n  /**\n   * Profile name from ~/.oci/config\n   *\n   * Default: 'DEFAULT' or OCI_CONFIG_PROFILE env var.\n   * The profile determines region, credentials, and tenancy.\n   *\n   * @example \"FRANKFURT\"\n   */\n  configProfile?: string;\n\n  /**\n   * Override region from profile\n   *\n   * Usually not needed - region comes from ~/.oci/config profile.\n   * Use only when you need a different region than the profile default.\n   *\n   * @example \"eu-frankfurt-1\"\n   */\n  region?: string;\n}\n\n/**\n * Default export: Factory function for OpenCode\n *\n * OpenCode calls this function with options from opencode.json\n * to create a ProviderV3 instance. This is the main entry point\n * for the integration.\n *\n * @param options - Configuration from opencode.json\n * @returns ProviderV3 instance for use with OpenCode\n *\n * @example\n * ```typescript\n * // OpenCode calls this internally with options from opencode.json\n * const provider = createOpenCodeOCIProvider({\n *   compartmentId: \"ocid1.compartment.oc1...\",\n *   configProfile: \"FRANKFURT\",\n * });\n * ```\n */\nexport default function createOpenCodeOCIProvider(options: OpenCodeOCIOptions): ProviderV3 {\n  // Build config, preferring explicit options over environment variables\n  const config: OCIConfig = {\n    // Compartment ID is required for OCI GenAI API calls\n    compartmentId: options.compartmentId || process.env.OCI_COMPARTMENT_ID,\n\n    // Profile name - region and credentials come from ~/.oci/config\n    profile: options.configProfile || process.env.OCI_CONFIG_PROFILE || 'DEFAULT',\n\n    // Region override (usually not needed, comes from profile)\n    region: options.region || process.env.OCI_REGION,\n\n    // Path to OCI config file\n    configPath: process.env.OCI_CONFIG_FILE,\n\n    // Always use config_file auth for OpenCode (OAuth planned for future)\n    auth: 'config_file',\n  };\n\n  // Validate required configuration\n  if (!config.compartmentId) {\n    throw new Error(\n      `OCI compartmentId is required.\n\nSet it in opencode.json:\n  \"options\": { \"compartmentId\": \"ocid1.compartment.oc1...\" }\n\nOr via environment variable:\n  export OCI_COMPARTMENT_ID=ocid1.compartment.oc1...`\n    );\n  }\n\n  const provider = createOCI(config);\n\n  console.log('DEBUG: Provider created:', typeof provider, !!provider.models);\n  if (provider.models) {\n    console.log('DEBUG: Registered OCI models:', Object.keys(provider.models).join(', '));\n  }\n\n  // Return provider with explicit models property for OpenCode discovery\n  const providerWithModels = {\n    ...provider,\n    models: provider.models,\n  };\n\n  return providerWithModels as any;\n}\n\n// ============================================================================\n// Re-export Core Provider\n// ============================================================================\n\nexport {\n  createOCI,\n  oci,\n  OCIGenAIProvider,\n  getAllModels,\n  getModelMetadata,\n  getModelsByFamily,\n  isValidModelId,\n  type OCIConfig,\n  type ModelMetadata,\n} from '@acedergren/oci-genai-provider';\n\n// ============================================================================\n// Re-export Config Utilities\n// ============================================================================\n\nexport {\n  parseOCIConfig,\n  hasOCIConfig,\n  getProfile,\n  validateCredentials,\n  discoverCompartments,\n  OCI_REGIONS,\n  getSetupInstructions,\n  isValidOCID,\n  type OCIProfile,\n  type OCIConfigResult,\n  type OCICompartment,\n  type ValidationResult,\n} from '@acedergren/oci-genai-provider/config';\n"]}