{"version":3,"file":"session-CLd7uHz-.js","sources":["../../../.svelte-kit/adapter-node/chunks/session.js"],"sourcesContent":["import { v4 } from \"uuid\";\nimport { g as getRepository } from \"./db.js\";\nconst SESSION_COOKIE = \"oci_chat_session\";\nconst COOKIE_OPTIONS = {\n  path: \"/\",\n  httpOnly: true,\n  secure: process.env.NODE_ENV === \"production\",\n  sameSite: \"lax\",\n  maxAge: 60 * 60 * 24 * 30\n  // 30 days\n};\nfunction getOrCreateSession(cookies, options) {\n  const repository = getRepository();\n  const existingId = cookies.get(SESSION_COOKIE);\n  if (existingId) {\n    const session2 = repository.getSession(existingId);\n    if (session2 && session2.status === \"active\") {\n      return { sessionId: existingId, isNew: false };\n    }\n  }\n  const session = repository.createSession({\n    id: v4(),\n    model: options.model,\n    region: options.region,\n    status: \"active\"\n  });\n  cookies.set(SESSION_COOKIE, session.id, COOKIE_OPTIONS);\n  return { sessionId: session.id, isNew: true };\n}\nfunction startNewSession(cookies, options) {\n  const repository = getRepository();\n  const oldId = cookies.get(SESSION_COOKIE);\n  if (oldId) {\n    try {\n      repository.updateSession(oldId, { status: \"completed\" });\n    } catch {\n    }\n  }\n  const session = repository.createSession({\n    id: v4(),\n    model: options.model,\n    region: options.region,\n    status: \"active\"\n  });\n  cookies.set(SESSION_COOKIE, session.id, COOKIE_OPTIONS);\n  return { sessionId: session.id, isNew: true };\n}\nfunction switchToSession(cookies, sessionId) {\n  const repository = getRepository();\n  const session = repository.getSession(sessionId);\n  if (!session) {\n    return false;\n  }\n  if (session.status === \"completed\") {\n    repository.updateSession(sessionId, { status: \"active\" });\n  }\n  cookies.set(SESSION_COOKIE, sessionId, COOKIE_OPTIONS);\n  return true;\n}\nfunction getCurrentSessionId(cookies) {\n  return cookies.get(SESSION_COOKIE);\n}\nexport {\n  switchToSession as a,\n  getCurrentSessionId as b,\n  getOrCreateSession as g,\n  startNewSession as s\n};\n"],"names":[],"mappings":"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"}